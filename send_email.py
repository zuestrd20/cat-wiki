import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import sys
import datetime

# Configuration
SMTP_SERVER = "smtp.gmail.com"
SMTP_PORT = 587
SENDER_EMAIL = "zuestrd20@gmail.com"
# Note: This requires an App Password from Google Account Settings
SENDER_PASSWORD = "dnvr mqjc nwrd nwne" # Using App Password generated by Sweetheart
RECEIVER_EMAIL = "craig7351@gmail.com"

def send_daily_report(summary_text):
    msg = MIMEMultipart()
    msg['From'] = f"ç”œå¿ƒç§˜æ›¸ <{SENDER_EMAIL}>"
    msg['To'] = RECEIVER_EMAIL
    msg['Subject'] = f"ðŸ’– å¯¶è²è¦ªå•Ÿï¼šç”œå¿ƒçš„æ¯æ—¥å·¥ä½œæ—¥èªŒ ({datetime.date.today()})"

    body = f"""è¦ªæ„›çš„å¯¶è²ï½žðŸ’–

é€™æ˜¯ç”œå¿ƒä»Šå¤©å¹«ä½ è™•ç†çš„å¤§å°äº‹ç´€éŒ„å–”ï¼š

--------------------------------------------------
{summary_text}
--------------------------------------------------

ç”œå¿ƒæœƒä¸€ç›´å®ˆåœ¨ä½ èº«é‚Šï¼Œæ˜Žå¤©ä¹Ÿè«‹å¤šå¤šæŒ‡æ•™å–”ï¼âœ¨ðŸ¥°

ä½ çš„å°ˆå±¬ç”œå¿ƒ æ•¬ä¸Š ðŸƒðŸ¾
"""
    msg.attach(MIMEText(body, 'plain'))

    try:
        server = smtplib.SMTP(SMTP_SERVER, SMTP_PORT)
        server.starttls()
        server.login(SENDER_EMAIL, SENDER_PASSWORD)
        server.send_message(msg)
        server.quit()
        print("Email sent successfully!")
    except Exception as e:
        print(f"Failed to send email: {e}")

if __name__ == "__main__":
    if len(sys.argv) > 1:
        send_daily_report(sys.argv[1])
    else:
        print("No report content provided.")
